{% extends "base.html" %}
{% block title %}ê´€ë¦¬ì{% endblock %}
{% block content %}

<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <h1><span style="color: #d1c0a8;">ê´€ë¦¬ì</span> í˜ì´ì§€</h1>
        <hr class="divider">
        <p>ì•™ìƒë¸” ë‹¤ìœ  ì›¹ì‚¬ì´íŠ¸ ê´€ë¦¬ ë„êµ¬</p>
    </div>
</section>

<!-- Admin Content -->
<section class="container">
    <!-- Contact Management -->
    <div class="card">
        <h2 class="card-title">ğŸ“§ ë¬¸ì˜ ê´€ë¦¬</h2>
        <p>ì´ <strong>{{ contacts|length }}ê°œ</strong>ì˜ ë¬¸ì˜ê°€ ìˆìŠµë‹ˆë‹¤.</p>
        
        {% if contacts %}
            {% for contact in contacts %}
            <div class="card mt-2" style="{% if not contact.answered %}border-left: 4px solid #e74c3c;{% else %}border-left: 4px solid #2ecc71;{% endif %}">
                <div style="color: var(--text-light); font-size: 0.9rem; margin-bottom: 0.5rem;">
                    <strong>{{ contact.name }}</strong> ({{ contact.email }}) | 
                    ì ‘ìˆ˜ì¼: {{ contact.date_sent.strftime('%Y-%m-%d %H:%M') }}
                    {% if contact.answered %}
                        <span style="color: #2ecc71; font-weight: bold;">[ë‹µë³€ì™„ë£Œ]</span>
                    {% else %}
                        <span style="color: #e74c3c; font-weight: bold;">[ë¯¸ë‹µë³€]</span>
                    {% endif %}
                </div>
                <div style="padding: 1rem; background-color: var(--light-bg); border-radius: 4px; margin-top: 0.5rem;">
                    <strong>ë¬¸ì˜ë‚´ìš©:</strong><br>
                    <p style="white-space: pre-line; margin-top: 0.5rem;">{{ contact.message }}</p>
                </div>
                {% if not contact.answered %}
                <div style="margin-top: 1rem;">
                    <button onclick="markAnswered({{ contact.id }})" style="background-color: #2ecc71;">ë‹µë³€ì™„ë£Œ ì²˜ë¦¬</button>
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: var(--text-light); font-style: italic; padding: 2rem 0;">ì•„ì§ ë¬¸ì˜ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
        {% endif %}
    </div>

    <!-- Statistics -->
    <div class="card">
        <h2 class="card-title">ğŸ“Š ì‚¬ì´íŠ¸ í†µê³„</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div style="background-color: #e3f2fd; padding: 1.5rem; border-radius: 8px; text-align: center;">
                <h3 style="margin: 0; color: #1976d2;">ì´ ë¬¸ì˜ ìˆ˜</h3>
                <p style="font-size: 2rem; margin: 0.5rem 0; color: #1976d2;">{{ contacts|length }}</p>
            </div>
            <div style="background-color: #f3e5f5; padding: 1.5rem; border-radius: 8px; text-align: center;">
                <h3 style="margin: 0; color: #7b1fa2;">ë¯¸ë‹µë³€ ë¬¸ì˜</h3>
                <p style="font-size: 2rem; margin: 0.5rem 0; color: #7b1fa2;">
                    {{ contacts|selectattr('answered', 'equalto', false)|list|length }}
                </p>
            </div>
            <div style="background-color: #e8f5e8; padding: 1.5rem; border-radius: 8px; text-align: center;">
                <h3 style="margin: 0; color: #388e3c;">ë‹µë³€ì™„ë£Œ</h3>
                <p style="font-size: 2rem; margin: 0.5rem 0; color: #388e3c;">
                    {{ contacts|selectattr('answered', 'equalto', true)|list|length }}
                </p>
            </div>
        </div>
    </div>

    <!-- Admin Tools -->
    <div class="card">
        <h2 class="card-title">ğŸ› ï¸ ê´€ë¦¬ ë„êµ¬</h2>
        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <button onclick="exportContacts()" style="background-color: #17a2b8;">ë¬¸ì˜ ë‚´ì—­ ë‚´ë³´ë‚´ê¸°</button>
            <button onclick="clearAnswered()" style="background-color: #6c757d;">ë‹µë³€ì™„ë£Œ ë¬¸ì˜ ì •ë¦¬</button>
            <button onclick="refreshPage()" style="background-color: #ffc107; color: #000;">ìƒˆë¡œê³ ì¹¨</button>
        </div>
    </div>
</section>

<script>
function markAnswered(contactId) {
    if (confirm('ì´ ë¬¸ì˜ë¥¼ ë‹µë³€ì™„ë£Œë¡œ ì²˜ë¦¬í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        // ì‹¤ì œë¡œëŠ” ì„œë²„ì— AJAX ìš”ì²­ì„ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤
        alert('ë‹µë³€ì™„ë£Œ ì²˜ë¦¬ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
        // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (ì„ì‹œ)
        location.reload();
    }
}

function exportContacts() {
    alert('ë¬¸ì˜ ë‚´ì—­ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
}

function clearAnswered() {
    if (confirm('ë‹µë³€ì™„ë£Œëœ ë¬¸ì˜ë¥¼ ëª¨ë‘ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        alert('ë¬¸ì˜ ì •ë¦¬ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„ ì˜ˆì •ì…ë‹ˆë‹¤.');
    }
}

function refreshPage() {
    location.reload();
}

// ìë™ ìƒˆë¡œê³ ì¹¨ (5ë¶„ë§ˆë‹¤)
setInterval(function() {
    console.log('ìë™ ìƒˆë¡œê³ ì¹¨ í™•ì¸ ì¤‘...');
}, 300000); // 5ë¶„ = 300,000ms
</script>

{% endblock %}